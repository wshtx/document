#### 红黑树性质

红黑树需要以下性质来保证平衡：

1. 节点是黑色或者红色；
2. 根节点是黑色；
3. 所有的叶子节点(NIL节点)都是黑色；
4. **每个黑色节点必须有两个红色的子节点**(从每个叶子节点到根节点的路径上不能有两个连续的红色节点)；
5. **从任意节点到每个叶子结点的路径上包含相同数目的黑色节点**。

#### 红黑树和2-3-4树的转换

![img](https://img-blog.csdnimg.cn/20190502083309952.png)

由于2-3-4树的3节点转换成红黑树节点是不确定，有左倾和右倾两种情况，所以一颗2-3-4树可对应多颗红黑树。相应的一颗红黑树唯一对应一颗2-3-4树。

![img](https://img-blog.csdnimg.cn/20190502083521996.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQxMDY2NDQ=,size_16,color_FFFFFF,t_70)

#### 红黑树插入逻辑

红黑树的插入删除可以类比2-3-4树。

1. **插入节点是红色节点且一定是叶子节点**。

   因为如果插入节点是黑色节点，那么这个节点所在路径的黑色节点数目会比其他路径多1。

2. ##### 红黑树的插入尽量不从颜色分类讨论，不易理解，还是从2-3-4树理解红黑树：

3. ##### 参照2-3-4树的插入红黑树插入有如下情况(左倾红黑树)：

   插入总是发生在叶子节点中，为了避免叶子结点是4节点没有插入空间，可以采用自顶向下的分裂策略：从根节点到插入节点的路径中，遇到4节点就分裂。**2-3-4树中的4节点分裂操作等同于红黑树中的染色操作，且分裂会产生两个连续红色链接或者右旋红色链接(这种情况对于左倾红黑树而言)。所以需要通过右旋和左旋来进行修正。**

   插入到2节点->黑父

   插入到3节点->红父|黑父+红兄弟

   分裂4节点->红父+黑兄弟|

   - 插入到2节点

     ![img](https://img-blog.csdnimg.cn/20190502085415515.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQxMDY2NDQ=,size_16,color_FFFFFF,t_70)

   - 插入到3节点

     ![img](https://img-blog.csdnimg.cn/20190502085610893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQxMDY2NDQ=,size_16,color_FFFFFF,t_70)
   
   - 插入到4节点，且4节点的父节点为2节点
   
     ![img](https://img-blog.csdnimg.cn/20190502090240189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQxMDY2NDQ=,size_16,color_FFFFFF,t_70)
   
   - 插入到4节点，且4节点的父节点为3节点
   
     ![img](https://img-blog.csdnimg.cn/20190502090400293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQxMDY2NDQ=,size_16,color_FFFFFF,t_70)

#### 红黑树删除逻辑

参照2-3-4树的删除逻辑，删除3节点和4节点类型的叶子节点时可以直接删除key；删除非叶子节点时可以用中序遍历的后继节点替换该节点，从而转换成删除叶子结点。所以难点还是如何删除2节点类型的叶子节点。

